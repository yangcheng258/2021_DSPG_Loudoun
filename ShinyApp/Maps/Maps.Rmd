---
title: "Interactive Map"
author: "Austin Burcham"
date: "6/24/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(readxl)
library(leaflet)
```

```{r}
# read in foster care and juvenile detention information
foster_care_info <- read_excel("C:\\Users\\austi\\Documents\\VT DSPG\\Loudoun\\Excel Files\\Research-Foster_care-New_col_added.xlsx")
juvie_det_info <- read_excel("C:\\Users\\austi\\Documents\\VT DSPG\\R files\\2021_DSPG_Loudoun\\Qualitative_research\\Research-Juvenile_Detention-New_col_added.xlsx")
# filter information to include only program name, longitude and latitude
# and remove entries that are NA
foster_care_locations <- foster_care_info %>% select(Program, Longitude, Latitude, Pillars) %>% 
rename(Longitude = Latitude, Latitude = Longitude) %>% 
filter(Longitude != "Online") %>% drop_na()

#Make longitude and latitude numeric
foster_care_locations$Longitude <- as.numeric(foster_care_locations$Longitude)
foster_care_locations$Latitude <- as.numeric(foster_care_locations$Latitude)

# Same process for juvie det
juvie_det_location <- juvie_det_info %>% select(Program, Longitude, Latitude, Pillars, Subpopulation) %>% 
filter(Longitude != "Online") %>% drop_na()
juvie_det_location$Longitude <- as.numeric(juvie_det_location$Longitude)
juvie_det_location$Latitude <- as.numeric(juvie_det_location$Latitude)

# Create color palettes to organize by whatever is desired
Pillar_pal <- colorFactor(pal = c('red', 'yellow', 'blue', 'orange', 'green'), 
                             levels = unique(juvie_det_location$Pillars))
subpop_pal <- colorFactor(pal = c('red', 'green'), 
                             levels = unique(juvie_det_location$Subpopulation))


# Use leaflet to map each location with circle markers and program name popups. 
foster_care_locations_map <- foster_care_locations %>% leaflet(options = leafletOptions(minZoom = 5)) %>% setView(lng = -78.457030, lat = 38.163355, zoom = 6) %>% addProviderTiles("CartoDB") %>% addCircleMarkers(lng = ~Longitude, lat = ~Latitude, popup = ~Program, radius = 2, color = ~Pillar_pal(Pillar))
# Same process for juvie_det
juvie_det_map <- juvie_det_location %>% leaflet(options = leafletOptions(minZoom = 5)) %>% setView(lng = -78.457030, lat = 38.163355, zoom = 6) %>% addProviderTiles("CartoDB") %>% addCircleMarkers(lng = ~Longitude, lat = ~Latitude, popup = paste0(juvie_det_location$Program, " (", juvie_det_location$Pillars, ")"), radius = 2, color = ~Pillar_pal(Pillars)) %>% addLegend(title = "Service Type", position = "bottomleft", pal = Pillar_pal, values = unique(juvie_det_location$Pillars))


juvie_and_foster_map <- foster_care_locations_map %>% addCircleMarkers(lng = juvie_det_location$Longitude, lat = juvie_det_location$Latitude, popup = juvie_det_location$Program, radius = 2, color = ~Pillar_pal(Pillars)) %>% addLegend(position = 'bottomleft', title = "Program Type", colors = c('red', 'green'), labels = c('Foster Care', 'Juvenile Detention') )

```

